<h2>ğŸ“Š Control Financiero</h2>

<!-- ğŸ”¥ SELECCIONAR EL MES A TRABAJAR -->
<div class="mes-selector">
  <label>Seleccionar mes:</label>
  <input type="month" [(ngModel)]="mesActivo" (change)="filtrarPorMes()">
</div>

<hr>

<!-- ğŸ” FILTRO POR CATEGORÃAS -->
<div class="filtros">
  <strong>Filtrar por categorÃ­a:</strong><br><br>

  <!-- SelecciÃ³n de AÃ‘O -->
  <label><strong>Seleccionar AÃ±o:</strong></label>
  <select [(ngModel)]="anioActivo" (change)="filtrarPorAnio()">
    <option *ngFor="let a of aniosDisponibles" [value]="a">
      {{ a }}
    </option>
  </select>
  <hr>
  <button *ngFor="let c of categorias" (click)="filtrarPorCategoria(c)">
    {{ c }}
  </button>

  <button (click)="filtrarPorAnio()">Mostrar aÃ±o seleccionado</button>
  <button (click)="filtrarPorMes()">Mostrar mes seleccionado</button>
  <button (click)="movimientosFiltrados = movimientos">Mostrar todas</button>

  <hr>
</div>


<hr>

<!-- Input para agregar nueva categorÃ­a -->
<div class="add-category">
  <input placeholder="Nueva categorÃ­a" [(ngModel)]="nuevaCategoria">
  <button class="btn-agregar-categoria" (click)="agregarCategoria()">â• Agregar categorÃ­a</button>
</div>

<hr>

<div class="form">
  <input placeholder="DescripciÃ³n" [(ngModel)]="descripcion">

  <input type="number" placeholder="Monto" [ngModel]="monto" (ngModelChange)="monto = +$event">

  <!-- SELECT de categorÃ­as -->
  <select [(ngModel)]="categoriaSeleccionada">
    <option value="">-- Seleccionar categorÃ­a --</option>

    <option *ngFor="let c of categorias" [value]="c">
      {{ c }}
    </option>
  </select>

  <select [(ngModel)]="tipo">
    <option value="gasto">Gasto</option>
    <option value="ingreso">Ingreso</option>
  </select>

  <button (click)="agregar()">Agregar</button>
</div>

<hr>

<table border="1" cellpadding="4" width="100%">
  <thead>
    <tr>
      <th>DescripciÃ³n</th>
      <th>CategorÃ­a</th>
      <th>Tipo</th>
      <th>Monto</th>
      <th>Acciones</th>
    </tr>
  </thead>

  <tbody>
    <tr *ngFor="let m of movimientosFiltrados">
      <td>{{ m.descripcion }}</td>
      <td>{{ m.categoria }}</td>

      <td [ngStyle]="{'color': m.tipo === 'ingreso' ? 'green' : 'red'}">
        {{ m.tipo | uppercase }}
      </td>

      <td [ngStyle]="{'color': m.tipo === 'ingreso' ? 'green' : 'red'}">
        {{ m.monto | currency:'CRC' }}
      </td>

      <td><button (click)="eliminar(m.id)">âŒ</button></td>
    </tr>
  </tbody>
</table>

<hr>

<div class="resumen-container" style="display: flex; justify-content: space-between; gap: 30px;">

  <!-- ğŸ”¹ RESUMEN DEL MES -->
  <div class="resumen">
    <h3>ğŸ“… Resumen del mes ({{ mesActivo }})</h3>
    <p>ğŸ’µ Total Ingresos: <strong>{{ totalIngresos() | currency:'CRC' }}</strong></p>
    <p>ğŸ’¸ Total Gastos: <strong>{{ totalGastos() | currency:'CRC' }}</strong></p>
    <p>ğŸ§¾ Balance Final:
      <strong [ngStyle]="{'color': balance() >= 0 ? 'green' : 'red'}">
        {{ balance() | currency:'CRC' }}
      </strong>
    </p>
  </div>

  <!-- ğŸ”¹ RESUMEN GLOBAL -->
  <div class="resumen" *ngIf="puedeVisualizarGeneral()">
    <h3>ğŸŒ Balance General</h3>
    <p>ğŸ’µ Ingresos Totales:
      <strong>{{ totalIngresosGlobal() | currency:'CRC' }}</strong>
    </p>
    <p>ğŸ’¸ Gastos Totales:
      <strong>{{ totalGastosGlobal() | currency:'CRC' }}</strong>
    </p>
    <p>ğŸ§¾ Balance General:
      <strong [ngStyle]="{'color': balanceGlobal() >= 0 ? 'green' : 'red'}">
        {{ balanceGlobal() | currency:'CRC' }}
      </strong>
    </p>
  </div>

</div>