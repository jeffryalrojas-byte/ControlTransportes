<h2>ğŸ’¼ Planilla Mensual</h2>
<hr>

<div style="display:flex; justify-content:space-between; margin-top:20px;">

  <div>
    <div style="display: flex; align-items: center; gap: 10px;">
      <label>ğŸ“… Mes:</label>
      <input type="month" [(ngModel)]="mesActual" (change)="onMesChange()">
      <button class="btn-guardar" (click)="guardarPlanilla()">ğŸ’¾ Guardar</button>
    </div>
  </div>

  <div style="
    border:1px solid #ccc;
    padding:15px;
    width:260px;
    border-radius:10px;
    background:#f7f7f7;">
    <h3>ğŸ“Œ Cargas Sociales Vigentes</h3>
    <p><strong>Trabajador:</strong> {{ ccssTrabajador * 100 }} %</p>
    <p><strong>Patrono:</strong> {{ ccssPatrono * 100 }} %</p>
  </div>

</div>

<table border="1" cellpadding="6">
  <thead>
    <tr>
      <th>Nombre</th>
      <th>Puesto</th>
      <th>Tipo Pago</th>
      <th>Salario Base</th>
      <th>DÃ­as Trabajados</th>
      <th>Salario Bruto</th>
      <th>Extras</th>
      <th>Rebajos Trabajador</th>
      <th>Salario Neto</th>
      <th>Cargas Patronales</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let e of empleados">
      <td>{{ e.nombre }}</td>
      <td>{{ e.puesto }}</td>
      <td>{{ e.tipoPago }}</td>
      <td>
        {{ e.salarioBase | currency:'CRC' }}
      </td>
      <td>
        <input *ngIf="e.tipoPago === 'diario'" type="number" min="0" [(ngModel)]="diasTrabajados[e.id]"
          (change)="actualizarDias(+e.id, $event)" style="width: 70px">
        <span *ngIf="e.tipoPago === 'mensual'">N/A</span>
      </td>
      <td>{{ salarioBruto(e) | currency:'CRC' }}</td>
      <td>
        <input type="number" [(ngModel)]="e.extras" (change)="calcularTotales()" min="0" style="width: 90px;">
      </td>
      <td>{{ rebajosTrabajador(e) | currency:'CRC' }}</td>
      <td>{{ salarioNeto(e) | currency:'CRC' }}</td>
      <td>{{ cargaPatronal(e) | currency:'CRC' }}</td>
    </tr>
  </tbody>
</table>

<hr>

<p><strong>ğŸ’° Total Planilla (Neto):</strong> {{ totalNeto | currency:'CRC' }}</p>
<p><strong>ğŸ¦ Total Cargas Patronales:</strong> {{ totalCargas | currency:'CRC' }}</p>

<hr>

<h3>ğŸ“š HistÃ³rico de planillas guardadas</h3>

<h4>Planillas {{ anioActual }}</h4>

<table border="1" cellpadding="6">
  <thead>
    <tr>
      <th>Mes</th>
      <th>Fecha de CreaciÃ³n</th>
      <th>Total Neto</th>
      <th>Total Cargas</th>
      <th>Acciones</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let p of planillasDelAnio">
      <td>{{ p.mes }}</td>
      <td>{{ p.fechaCreacion }}</td>
      <td>{{ p.totalNeto | currency:'CRC' }}</td>
      <td>{{ p.totalCargas | currency:'CRC' }}</td>
      <td>
        <button *ngIf="!puedeEliminar(p)" (click)="eliminarPlanilla(p)">âŒ Eliminar</button>
      </td>
    </tr>
  </tbody>
</table>

<!-- BOTÃ“N PARA MOSTRAR AÃ‘OS ANTERIORES -->
<button (click)="mostrarAnteriores = !mostrarAnteriores" class="btn-guardar">
  {{ mostrarAnteriores ? 'â¬† Ocultar aÃ±os anteriores' : 'â¬‡ Mostrar aÃ±os anteriores' }}
</button>

<!-- SECCIÃ“N DE AÃ‘OS ANTERIORES -->
<div *ngIf="mostrarAnteriores">
  <h4>AÃ±os anteriores</h4>

  <table border="1" cellpadding="6">
    <thead>
      <tr>
        <th>Mes</th>
        <th>Fecha de CreaciÃ³n</th>
        <th>Total Neto</th>
        <th>Total Cargas</th>
        <th>Acciones</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let p of planillasAnteriores">
        <td>{{ p.mes }}</td>
        <td>{{ p.fechaCreacion }}</td>
        <td>{{ p.totalNeto | currency:'CRC' }}</td>
        <td>{{ p.totalCargas | currency:'CRC' }}</td>
        <td>
          <button *ngIf="!puedeEliminar(p)" (click)="eliminarPlanilla(p)">âŒ Eliminar</button>
        </td>
      </tr>
    </tbody>
  </table>
</div>